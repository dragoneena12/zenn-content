---
title: "DMX512を使ってテープライトを制御してみる"
emoji: "🌈"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["DMX512", "WS2812B", "Arduino"]
published: false
---

## はじめに

こんにちは、Lapi（[@dragoneena12](https://github.com/dragoneena12)）です。ステージ照明って良いですよね。でも機材を買うお金がないので自作してみました。

<良い感じのGIF>

備忘録も兼ねて作り方を書いていこうと思います！

## 材料

| 材料名（リンクは参考） | 価格 | 用途等 |
| ---- | ---- | ---- |
| [Arduino Nano Every](https://akizukidenshi.com/catalog/g/gM-14848/) | 2,360 | DMX信号を受信してテープライトに信号を送る。ATmega328Pとかを使えばもっと安くなるはず。 |
| [LTC485CN8](https://akizukidenshi.com/catalog/g/gI-02792/) | 250 | RS485トランシーバ。 |
| [USB-DMX インターフェースケーブル](https://www.amazon.co.jp/dp/B07WV6P5W6/) | 2,399 | PCからDMX信号を出力する。 |
| [XLR オスコネクタ](https://www.soundhouse.co.jp/products/detail/item/56110/) | 520 | キャノンコネクタの接続部分。 |
| [WS2812B テープライト](https://www.amazon.co.jp/dp/B088JWT7VT/) | 899 | 実際光る部分。少し高いが1m144LEDのものもある。 |
| [USB Type-C コネクタ DIP 化キット](https://akizukidenshi.com/catalog/g/gK-15426/) | 180 | USB Type-C を電源として使う。 |
| [フラットモール](https://www.biccamera.com/bc/item/1375717/) | 260 | テープライトを貼り付ける土台。 |

## 回路図

![回路図](https://storage.googleapis.com/zenn-user-upload/37f91c97ac24-20231220.png)

## Arduino プログラム作成

### ライブラリインストール

以下の2つのライブラリをインストールします。それぞれzipで落として展開し、`~/Documents/Arduino/libraries/` 以下に配置すればOKです。

- [DMXSerial](https://github.com/mathertel/DMXSerial)
- [Adafruit_NeoPixel](https://github.com/adafruit/Adafruit_NeoPixel)

### プログラム作成

```cpp
#include <DMXSerial.h>
#include <Adafruit_NeoPixel.h>

const int LED_PIN = 3;
const int LED_COUNT = 60;

Adafruit_NeoPixel pixels(LED_COUNT, LED_PIN, NEO_GRB + NEO_KHZ800);

const int startChannel = 1;

void setup() {
  DMXSerial.init(DMXProbe);
  pixels.begin();
  Serial.begin(115200,SERIAL_8N2);
}


void loop() {
  unsigned long lastPacket = DMXSerial.noDataSince();
  pixels.clear();
  DMXSerial.receive();

  if (lastPacket < 5000) {
    for(int i=0; i<LED_COUNT; i++) {
      int var_r = DMXSerial.read(startChannel + 3 * i);
      int var_g = DMXSerial.read(startChannel + 3 * i + 1);
      int var_b = DMXSerial.read(startChannel + 3 * i + 2);
      pixels.setPixelColor(i, pixels.Color(var_r, var_g, var_b));
    }
  } else {
    for(int i=0; i<LED_COUNT; i++) {
      pixels.setPixelColor(i, pixels.Color(0, 0, 10));
    }
  }
  pixels.show();
}
```

## 参考
- [ArduinoでDMXを受信する](https://hikoleaf.hatenablog.jp/entry/2019/05/26/124746)
- [Type-C CurrentでUSBを使う、Type-Cコネクタから電源を取り出す【逆引き回路設計】](https://voltechno.com/blog/type-c-current/)
- [ArduinoとシリアルLED（WS2812B）](https://101010.fun/iot/arduino-serial-led.html)
